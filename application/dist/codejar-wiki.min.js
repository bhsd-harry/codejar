import"https://testingcf.jsdelivr.net/npm/wikiparser-node@browser/extensions/dist/base.min.js";var te=window;function X(n,O,P={}){let m={spellcheck:!1,history:!0,window:te,...P},l=m.window,f=l.document,L=[],u=[],a=-1,E=!1,h=()=>{},x;n.setAttribute("contenteditable","plaintext-only"),n.setAttribute("spellcheck",m.spellcheck?"true":"false"),n.style.outline="none",n.style.overflowWrap="break-word",n.style.overflowY="auto",n.style.whiteSpace="pre-wrap";let b;async function v(){let e=p(),t=await O(n);if(p()===e){b=!1;let o=T();n.innerHTML=t,w(o),y();return}return v()}let C=()=>{b||(b=!0,v())},K=!1;n.contentEditable!=="plaintext-only"&&(K=!0),K&&n.setAttribute("contenteditable","true");let Z=V(()=>{C()},30),S=!1,_=e=>!j(e)&&!z(e)&&e.key!=="Meta"&&e.key!=="Control"&&e.key!=="Alt"&&!e.key.startsWith("Arrow"),F=V(e=>{_(e)&&(y(),S=!1)},300),N=(e,t)=>{L.push([e,t]),n.addEventListener(e,t)};N("keydown",e=>{e.defaultPrevented||(x=p(),$(e),m.history&&(G(e),_(e)&&!S&&(y(),S=!0)),K&&!ee(e)&&w(T()))}),N("keyup",e=>{e.defaultPrevented||e.isComposing||(x!==p()&&Z(),F(e),h(p()))}),N("focus",e=>{E=!0}),N("blur",e=>{E=!1}),N("paste",e=>{y(),I(e),y(),h(p())}),N("cut",e=>{y(),Q(e),y(),h(p())});function T(){let e=M(),t={start:0,end:0,dir:void 0},{anchorNode:o,anchorOffset:i,focusNode:r,focusOffset:d}=e;if(!o||!r)throw"error1";if(o===n&&r===n)return t.start=i>0&&n.textContent?n.textContent.length:0,t.end=d>0&&n.textContent?n.textContent.length:0,t.dir=d>=i?"->":"<-",t;if(o.nodeType===Node.ELEMENT_NODE){let s=f.createTextNode("");o.insertBefore(s,o.childNodes[i]),o=s,i=0}if(r.nodeType===Node.ELEMENT_NODE){let s=f.createTextNode("");r.insertBefore(s,r.childNodes[d]),r=s,d=0}return U(s=>{if(s===o&&s===r)return t.start+=i,t.end+=d,t.dir=i<=d?"->":"<-","stop";if(s===o)if(t.start+=i,!t.dir)t.dir="->";else return"stop";else if(s===r)if(t.end+=d,!t.dir)t.dir="<-";else return"stop";s.nodeType===Node.TEXT_NODE&&(t.dir!="->"&&(t.start+=s.nodeValue.length),t.dir!="<-"&&(t.end+=s.nodeValue.length))}),n.normalize(),t}function w(e){var W,q;let t=M(),o,i=0,r,d=0;if(e.dir||(e.dir="->"),e.start<0&&(e.start=0),e.end<0&&(e.end=0),e.dir=="<-"){let{start:c,end:g}=e;e.start=g,e.end=c}let s=0;U(c=>{if(c.nodeType!==Node.TEXT_NODE)return;let g=(c.nodeValue||"").length;if(s+g>e.start&&(o||(o=c,i=e.start-s),s+g>e.end))return r=c,d=e.end-s,"stop";s+=g}),o||(o=n,i=n.childNodes.length),r||(r=n,d=n.childNodes.length),e.dir=="<-"&&([o,i,r,d]=[r,d,o,i]);{let c=B(o);if(c){let H=f.createTextNode("");(W=c.parentNode)==null||W.insertBefore(H,c),o=H,i=0}let g=B(r);if(g){let H=f.createTextNode("");(q=g.parentNode)==null||q.insertBefore(H,g),r=H,d=0}}t.setBaseAndExtent(o,i,r,d),n.normalize()}function B(e){for(;e&&e!==n;){if(e.nodeType===Node.ELEMENT_NODE){let t=e;if(t.getAttribute("contenteditable")=="false")return t}e=e.parentNode}}function Y(){let t=M().getRangeAt(0),o=f.createRange();return o.selectNodeContents(n),o.setStart(t.endContainer,t.endOffset),o.toString()}function $(e){if(K&&e.key==="Enter")if(k(e),e.stopPropagation(),Y()==""){R(`
 `);let t=T();t.start=--t.end,w(t)}else R(`
`)}function G(e){if(j(e)){k(e),a--;let t=u[a];t&&(n.innerHTML=t.html,w(t.pos)),a<0&&(a=0)}if(z(e)){k(e),a++;let t=u[a];t&&(n.innerHTML=t.html,w(t.pos)),a>=u.length&&a--}}function y(){if(!E)return;let e=p(),t=n.innerHTML,o=T(),i=u[a];if(i&&i.html===t&&i.pos.start===o.start&&i.pos.end===o.end)return;(i==null?void 0:i.text)!==e&&a++,u[a]={text:e,html:t,pos:o},u.splice(a+1);let r=300;a>r&&(a=r,u.splice(0,1))}function I(e){var i;if(e.defaultPrevented)return;k(e);let o=((i=e.originalEvent)!=null?i:e).clipboardData.getData("text/plain").replace(/\r\n?/g,`
`);R(o),C()}function Q(e){var i;let t=M();((i=e.originalEvent)!=null?i:e).clipboardData.setData("text/plain",t.toString()),f.execCommand("delete"),C(),k(e)}function U(e){let t=[];n.firstChild&&t.push(n.firstChild);let o=t.pop();for(;o&&e(o)!=="stop";)o.nextSibling&&t.push(o.nextSibling),o.firstChild&&t.push(o.firstChild),o=t.pop()}function A(e){return e.metaKey||e.ctrlKey}function j(e){return A(e)&&!e.shiftKey&&D(e)==="Z"}function z(e){return A(e)&&e.shiftKey&&D(e)==="Z"}function ee(e){return A(e)&&D(e)==="C"}function D(e){let t=e.key||e.keyCode||e.which;if(t)return(typeof t=="string"?t:String.fromCharCode(t)).toUpperCase()}function R(e){e=e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;"),f.execCommand("insertHTML",!1,e)}function V(e,t){let o=0;return(...i)=>{clearTimeout(o),o=l.setTimeout(()=>e(...i),t)}}function p(){return n.textContent||""}function k(e){e.preventDefault()}function M(){return n.getRootNode().getSelection()}return{updateOptions(e){Object.assign(m,e)},updateCode(e,t=!0){n.textContent=e,n.focus(),C(),t&&h(e)},onUpdate(e){h=e},toString:p,save:T,restore:w,recordHistory:y,destroy(){for(let[e,t]of L)n.removeEventListener(e,t)}}}var J=document.createElement("link");J.rel="stylesheet";J.href="https://testingcf.jsdelivr.net/npm/wikiparser-node@browser/extensions/ui.min.css";document.head.append(J);var re=(n,O)=>{var b;let P=wikiparse.id++,m=async v=>(await wikiparse.print(v.textContent,O,void 0,P)).map(([,,C])=>C).join(""),l=document.createElement("div"),{font:f,lineHeight:L,padding:u,background:a}=getComputedStyle(n),{offsetHeight:E,style:{height:h}}=n;l.textContent=n.value,l.style.height=E?`${E}px`:h,l.style.minHeight="100px",l.style.boxSizing="border-box",l.style.font=f,l.style.lineHeight=L,l.style.padding=u,l.style.background=a,n.after(l),n.style.display="none",l.focus();let x=X(l,m,{spellcheck:!0});return(b=n.form)==null||b.addEventListener("submit",()=>{n.value=x.toString()}),x};export{re as CodeJar};
//# sourceMappingURL=codejar-wiki.min.js.map
