import"https://testingcf.jsdelivr.net/npm/wikiparser-node@browser/extensions/dist/base.min.js";var ee=window;function z(o,H,L={}){let y={spellcheck:!1,history:!0,window:ee,...L},x=y.window,c=x.document,D=[],g=[],a=-1,K=!1,m=()=>{},S;o.setAttribute("contenteditable","plaintext-only"),o.setAttribute("spellcheck",y.spellcheck?"true":"false"),o.style.outline="none",o.style.overflowWrap="break-word",o.style.overflowY="auto",o.style.whiteSpace="pre-wrap";let M;async function R(){let e=f(),t=await H(o);if(f()===e){M=!1;let n=b();o.innerHTML=t,E(n),p();return}return R()}let T=()=>{M||(M=!0,R())},w=!1;o.contentEditable!=="plaintext-only"&&(w=!0),w&&o.setAttribute("contenteditable","true");let X=W(()=>{T()},30),O=!1,J=e=>!U(e)&&!V(e)&&e.key!=="Meta"&&e.key!=="Control"&&e.key!=="Alt"&&!e.key.startsWith("Arrow"),Z=W(e=>{J(e)&&(p(),O=!1)},300),h=(e,t)=>{D.push([e,t]),o.addEventListener(e,t)};h("keydown",e=>{e.defaultPrevented||(S=f(),Y(e),y.history&&(G(e),J(e)&&!O&&(p(),O=!0)),w&&!$(e)&&E(b()))}),h("keyup",e=>{e.defaultPrevented||e.isComposing||(S!==f()&&X(),Z(e),m(f()))}),h("focus",e=>{K=!0}),h("blur",e=>{K=!1}),h("paste",e=>{p(),I(e),p(),m(f())}),h("cut",e=>{p(),Q(e),p(),m(f())});function b(){let e=k(),t={start:0,end:0,dir:void 0},{anchorNode:n,anchorOffset:r,focusNode:i,focusOffset:l}=e;if(!n||!i)throw"error1";if(n===o&&i===o)return t.start=r>0&&o.textContent?o.textContent.length:0,t.end=l>0&&o.textContent?o.textContent.length:0,t.dir=l>=r?"->":"<-",t;if(n.nodeType===Node.ELEMENT_NODE){let s=c.createTextNode("");n.insertBefore(s,n.childNodes[r]),n=s,r=0}if(i.nodeType===Node.ELEMENT_NODE){let s=c.createTextNode("");i.insertBefore(s,i.childNodes[l]),i=s,l=0}return B(s=>{if(s===n&&s===i)return t.start+=r,t.end+=l,t.dir=r<=l?"->":"<-","stop";if(s===n)if(t.start+=r,!t.dir)t.dir="->";else return"stop";else if(s===i)if(t.end+=l,!t.dir)t.dir="<-";else return"stop";s.nodeType===Node.TEXT_NODE&&(t.dir!="->"&&(t.start+=s.nodeValue.length),t.dir!="<-"&&(t.end+=s.nodeValue.length))}),o.normalize(),t}function E(e){var j,q;let t=k(),n,r=0,i,l=0;if(e.dir||(e.dir="->"),e.start<0&&(e.start=0),e.end<0&&(e.end=0),e.dir=="<-"){let{start:d,end:u}=e;e.start=u,e.end=d}let s=0;B(d=>{if(d.nodeType!==Node.TEXT_NODE)return;let u=(d.nodeValue||"").length;if(s+u>e.start&&(n||(n=d,r=e.start-s),s+u>e.end))return i=d,l=e.end-s,"stop";s+=u}),n||(n=o,r=o.childNodes.length),i||(i=o,l=o.childNodes.length),e.dir=="<-"&&([n,r,i,l]=[i,l,n,r]);{let d=_(n);if(d){let N=c.createTextNode("");(j=d.parentNode)==null||j.insertBefore(N,d),n=N,r=0}let u=_(i);if(u){let N=c.createTextNode("");(q=u.parentNode)==null||q.insertBefore(N,u),i=N,l=0}}t.setBaseAndExtent(n,r,i,l),o.normalize()}function _(e){for(;e&&e!==o;){if(e.nodeType===Node.ELEMENT_NODE){let t=e;if(t.getAttribute("contenteditable")=="false")return t}e=e.parentNode}}function F(){let t=k().getRangeAt(0),n=c.createRange();return n.selectNodeContents(o),n.setStart(t.endContainer,t.endOffset),n.toString()}function Y(e){if(w&&e.key==="Enter")if(C(e),e.stopPropagation(),F()==""){A(`
 `);let t=b();t.start=--t.end,E(t)}else A(`
`)}function G(e){if(U(e)){C(e),a--;let t=g[a];t&&(o.innerHTML=t.html,E(t.pos)),a<0&&(a=0)}if(V(e)){C(e),a++;let t=g[a];t&&(o.innerHTML=t.html,E(t.pos)),a>=g.length&&a--}}function p(){if(!K)return;let e=f(),t=o.innerHTML,n=b(),r=g[a];if(r&&r.html===t&&r.pos.start===n.start&&r.pos.end===n.end)return;(r==null?void 0:r.text)!==e&&a++,g[a]={text:e,html:t,pos:n},g.splice(a+1);let i=300;a>i&&(a=i,g.splice(0,1))}function I(e){var r;if(e.defaultPrevented)return;C(e);let n=((r=e.originalEvent)!=null?r:e).clipboardData.getData("text/plain").replace(/\r\n?/g,`
`);A(n),T()}function Q(e){var r;let t=k();((r=e.originalEvent)!=null?r:e).clipboardData.setData("text/plain",t.toString()),c.execCommand("delete"),T(),C(e)}function B(e){let t=[];o.firstChild&&t.push(o.firstChild);let n=t.pop();for(;n&&e(n)!=="stop";)n.nextSibling&&t.push(n.nextSibling),n.firstChild&&t.push(n.firstChild),n=t.pop()}function P(e){return e.metaKey||e.ctrlKey}function U(e){return P(e)&&!e.shiftKey&&v(e)==="Z"}function V(e){return P(e)&&e.shiftKey&&v(e)==="Z"}function $(e){return P(e)&&v(e)==="C"}function v(e){let t=e.key||e.keyCode||e.which;if(t)return(typeof t=="string"?t:String.fromCharCode(t)).toUpperCase()}function A(e){e=e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;"),c.execCommand("insertHTML",!1,e)}function W(e,t){let n=0;return(...r)=>{clearTimeout(n),n=x.setTimeout(()=>e(...r),t)}}function f(){return o.textContent||""}function C(e){e.preventDefault()}function k(){return o.getRootNode().getSelection()}return{updateOptions(e){Object.assign(y,e)},updateCode(e,t=!0){o.textContent=e,o.focus(),T(),t&&m(e)},onUpdate(e){m=e},toString:f,save:b,restore:E,recordHistory:p,destroy(){for(let[e,t]of D)o.removeEventListener(e,t)}}}var re=(o,H)=>{let L=async x=>(await wikiparse.print(x.textContent,H)).map(([,,c])=>c).join(""),y=document.createElement("div");return o.after(y),o.style.display="none",z(y,L,{spellcheck:!0})};export{re as CodeJar};
//# sourceMappingURL=codejar-wiki.min.js.map
