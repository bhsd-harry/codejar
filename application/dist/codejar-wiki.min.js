import"https://testingcf.jsdelivr.net/npm/wikiparser-node@browser/extensions/dist/base.min.js";var ee=window;function q(n,O,P={}){let E={spellcheck:!1,history:!0,window:ee,...P},d=E.window,f=d.document,k=[],u=[],a=-1,C=!1,y=()=>{},N;n.setAttribute("contenteditable","plaintext-only"),n.setAttribute("spellcheck",E.spellcheck?"true":"false"),n.style.outline="none",n.style.overflowWrap="break-word",n.style.overflowY="auto",n.style.whiteSpace="pre-wrap";let x;async function L(){let e=p(),t=await O(n);if(p()===e){x=!1;let o=T();n.innerHTML=t,b(o),h();return}return L()}let v=()=>{x||(x=!0,L())},K=!1;n.contentEditable!=="plaintext-only"&&(K=!0),K&&n.setAttribute("contenteditable","true");let X=z(()=>{v()},30),S=!1,J=e=>!U(e)&&!j(e)&&e.key!=="Meta"&&e.key!=="Control"&&e.key!=="Alt"&&!e.key.startsWith("Arrow"),Z=z(e=>{J(e)&&(h(),S=!1)},300),m=(e,t)=>{k.push([e,t]),n.addEventListener(e,t)};m("keydown",e=>{e.defaultPrevented||(N=p(),Y(e),E.history&&($(e),J(e)&&!S&&(h(),S=!0)),K&&!Q(e)&&b(T()))}),m("keyup",e=>{e.defaultPrevented||e.isComposing||(N!==p()&&X(),Z(e),y(p()))}),m("focus",e=>{C=!0}),m("blur",e=>{C=!1}),m("paste",e=>{h(),G(e),h(),y(p())}),m("cut",e=>{h(),I(e),h(),y(p())});function T(){let e=M(),t={start:0,end:0,dir:void 0},{anchorNode:o,anchorOffset:i,focusNode:r,focusOffset:l}=e;if(!o||!r)throw"error1";if(o===n&&r===n)return t.start=i>0&&n.textContent?n.textContent.length:0,t.end=l>0&&n.textContent?n.textContent.length:0,t.dir=l>=i?"->":"<-",t;if(o.nodeType===Node.ELEMENT_NODE){let s=f.createTextNode("");o.insertBefore(s,o.childNodes[i]),o=s,i=0}if(r.nodeType===Node.ELEMENT_NODE){let s=f.createTextNode("");r.insertBefore(s,r.childNodes[l]),r=s,l=0}return B(s=>{if(s===o&&s===r)return t.start+=i,t.end+=l,t.dir=i<=l?"->":"<-","stop";if(s===o)if(t.start+=i,!t.dir)t.dir="->";else return"stop";else if(s===r)if(t.end+=l,!t.dir)t.dir="<-";else return"stop";s.nodeType===Node.TEXT_NODE&&(t.dir!="->"&&(t.start+=s.nodeValue.length),t.dir!="<-"&&(t.end+=s.nodeValue.length))}),n.normalize(),t}function b(e){var V,W;let t=M(),o,i=0,r,l=0;if(e.dir||(e.dir="->"),e.start<0&&(e.start=0),e.end<0&&(e.end=0),e.dir=="<-"){let{start:c,end:g}=e;e.start=g,e.end=c}let s=0;B(c=>{if(c.nodeType!==Node.TEXT_NODE)return;let g=(c.nodeValue||"").length;if(s+g>e.start&&(o||(o=c,i=e.start-s),s+g>e.end))return r=c,l=e.end-s,"stop";s+=g}),o||(o=n,i=n.childNodes.length),r||(r=n,l=n.childNodes.length),e.dir=="<-"&&([o,i,r,l]=[r,l,o,i]);{let c=_(o);if(c){let H=f.createTextNode("");(V=c.parentNode)==null||V.insertBefore(H,c),o=H,i=0}let g=_(r);if(g){let H=f.createTextNode("");(W=g.parentNode)==null||W.insertBefore(H,g),r=H,l=0}}t.setBaseAndExtent(o,i,r,l),n.normalize()}function _(e){for(;e&&e!==n;){if(e.nodeType===Node.ELEMENT_NODE){let t=e;if(t.getAttribute("contenteditable")=="false")return t}e=e.parentNode}}function F(){let t=M().getRangeAt(0),o=f.createRange();return o.selectNodeContents(n),o.setStart(t.endContainer,t.endOffset),o.toString()}function Y(e){if(K&&e.key==="Enter")if(w(e),e.stopPropagation(),F()==""){R(`
 `);let t=T();t.start=--t.end,b(t)}else R(`
`)}function $(e){if(U(e)){w(e),a--;let t=u[a];t&&(n.innerHTML=t.html,b(t.pos)),a<0&&(a=0)}if(j(e)){w(e),a++;let t=u[a];t&&(n.innerHTML=t.html,b(t.pos)),a>=u.length&&a--}}function h(){if(!C)return;let e=p(),t=n.innerHTML,o=T(),i=u[a];if(i&&i.html===t&&i.pos.start===o.start&&i.pos.end===o.end)return;(i==null?void 0:i.text)!==e&&a++,u[a]={text:e,html:t,pos:o},u.splice(a+1);let r=300;a>r&&(a=r,u.splice(0,1))}function G(e){var i;if(e.defaultPrevented)return;w(e);let o=((i=e.originalEvent)!=null?i:e).clipboardData.getData("text/plain").replace(/\r\n?/g,`
`);R(o),v()}function I(e){var i;let t=M();((i=e.originalEvent)!=null?i:e).clipboardData.setData("text/plain",t.toString()),f.execCommand("delete"),v(),w(e)}function B(e){let t=[];n.firstChild&&t.push(n.firstChild);let o=t.pop();for(;o&&e(o)!=="stop";)o.nextSibling&&t.push(o.nextSibling),o.firstChild&&t.push(o.firstChild),o=t.pop()}function A(e){return e.metaKey||e.ctrlKey}function U(e){return A(e)&&!e.shiftKey&&D(e)==="Z"}function j(e){return A(e)&&e.shiftKey&&D(e)==="Z"}function Q(e){return A(e)&&D(e)==="C"}function D(e){let t=e.key||e.keyCode||e.which;if(t)return(typeof t=="string"?t:String.fromCharCode(t)).toUpperCase()}function R(e){e=e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;"),f.execCommand("insertHTML",!1,e)}function z(e,t){let o=0;return(...i)=>{clearTimeout(o),o=d.setTimeout(()=>e(...i),t)}}function p(){return n.textContent||""}function w(e){e.preventDefault()}function M(){return n.getRootNode().getSelection()}return{updateOptions(e){Object.assign(E,e)},updateCode(e,t=!0){n.textContent=e,n.focus(),v(),t&&y(e)},onUpdate(e){y=e},toString:p,save:T,restore:b,recordHistory:h,destroy(){for(let[e,t]of k)n.removeEventListener(e,t)}}}var ie=(n,O)=>{var N;let P=wikiparse.id++,E=async x=>(await wikiparse.print(x.textContent,O,void 0,P)).map(([,,L])=>L).join(""),d=document.createElement("div"),{font:f,lineHeight:k,padding:u}=getComputedStyle(n),{offsetHeight:a,style:{height:C}}=n;d.textContent=n.value,d.style.height=a?`${a}px`:C,d.style.minHeight="100px",d.style.boxSizing="border-box",d.style.font=f,d.style.lineHeight=k,d.style.padding=u,n.after(d),n.style.display="none";let y=q(d,E,{spellcheck:!0});return(N=n.form)==null||N.addEventListener("submit",()=>{n.value=y.toString()}),y};export{ie as CodeJar};
//# sourceMappingURL=codejar-wiki.min.js.map
